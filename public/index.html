<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì§€ì›ì§€ë‹ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: #f5f7fb;
      color: #222;
    }

    .wrap {
      max-width: 900px;
      margin: 40px auto 60px;
      padding: 0 16px;
    }

    .header {
      text-align: center;
      margin-bottom: 32px;
    }

    .title {
      font-size: 32px;
      font-weight: 800;
      letter-spacing: 4px;
      color: #153e9f;
    }

    .subtitle {
      margin-top: 8px;
      font-size: 13px;
      color: #777;
    }

    .search-box {
      background: #fff;
      border-radius: 12px;
      padding: 20px 20px 16px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.10);
      border: 1px solid #e2e8f0;
      margin-bottom: 20px;
    }

    .search-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .search-row input[type="text"] {
      flex: 1 1 220px;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-size: 14px;
      outline: none;
    }

    .search-row input[type="text"]:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.15);
    }

    .search-row select {
      flex: 0 0 130px;
      padding: 9px 8px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-size: 13px;
      background: #f8fafc;
    }

    .search-row button {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      background: #2563eb;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      flex: 0 0 80px;
    }

    .search-row button:hover {
      background: #1d4ed8;
    }

    .tips {
      margin-top: 8px;
      font-size: 12px;
      color: #94a3b8;
    }

    .result-info {
      font-size: 13px;
      color: #6b7280;
      margin: 6px 2px 10px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 14px;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
      border: 1px solid #e2e8f0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 700;
      color: #111827;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .chip {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
    }

    .meta {
      font-size: 13px;
      color: #4b5563;
      margin-top: 4px;
      line-height: 1.5;
    }

    .meta span {
      display: block;
    }

    .deadline {
      font-weight: 600;
      color: #b91c1c;
    }

    .link {
      margin-top: 8px;
      font-size: 13px;
    }

    .link a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
    }

    .link a:hover {
      text-decoration: underline;
    }

    .empty {
      text-align: center;
      color: #9ca3af;
      font-size: 14px;
      margin-top: 40px;
    }

    @media (max-width: 600px) {
      .wrap {
        margin-top: 24px;
      }
      .search-row {
        flex-direction: column;
        align-items: stretch;
      }
      .search-row select,
      .search-row button {
        flex: 1 1 auto;
        width: 100%;
      }
      .title {
        font-size: 26px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="title">ì§€ì›ì§€ë‹ˆ ğŸ”</div>
      <div class="subtitle">í‚¤ì›Œë“œë¡œ ì •ì±…ì„ ì°¾ê³ , í•„í„°ë¡œ ë¹ ë¥´ê²Œ ì¢í˜€ë³´ëŠ” ì •ì±… ê²€ìƒ‰ ë„ìš°ë¯¸</div>
    </header>

    <section class="search-box">
      <div class="search-row">
        <input id="queryInput" type="text" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì²­ë…„, ì™¸ì‹, ê²½ê¸°)" />

        <select id="categorySelect">
          <option value="">ì „ì²´ ìœ í˜•</option>
          <option value="ì²­ë…„">ì²­ë…„</option>
          <option value="ì¤‘ì¥ë…„">ì¤‘ì¥ë…„</option>
          <option value="í•œë¶€ëª¨">í•œë¶€ëª¨</option>
          <option value="ì¥ì• ì¸">ì¥ì• ì¸</option>
          <option value="ì†Œìƒê³µì¸">ì†Œìƒê³µì¸</option>
        </select>

        <select id="targetSelect">
          <option value="">ì „ì²´ ëŒ€ìƒ</option>
          <option value="ê°œì¸">ê°œì¸</option>
          <option value="ê¸°ì—…">ê¸°ì—…</option>
          <option value="ë‹¨ì²´">ë‹¨ì²´</option>
        </select>

        <button id="searchBtn">ê²€ìƒ‰</button>
      </div>
      <div class="tips">
        ì˜ˆì‹œ) <b>ì²­ë…„ ì™¸ì‹</b>, <b>ê²½ê¸° ì¹´í˜</b>, <b>í•œë¶€ëª¨ ì›”ì„¸</b> ë“± ììœ ë¡­ê²Œ ê²€ìƒ‰í•´ ë³´ì„¸ìš”.
      </div>
    </section>

    <div id="resultInfo" class="result-info"></div>
    <section id="resultArea" class="grid"></section>
    <div id="emptyMsg" class="empty" style="display:none;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. í‚¤ì›Œë“œë¥¼ ë°”ê¿”ì„œ ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”.</div>
  </div>

<script>
async function performSearch() {
    const queryInput = document.getElementById("query");
    const categoryInput = document.getElementById("category");
    const resultsDiv = document.getElementById("results");

    const queryValue = queryInput.value.trim();
    const categoryValue = categoryInput.value.trim();

    // ê²€ìƒ‰ì–´ + ì¹´í…Œê³ ë¦¬ ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ìˆì–´ë„ ê²€ìƒ‰ ìˆ˜í–‰
    const finalQuery = categoryValue || queryValue;

    if (!finalQuery) {
        resultsDiv.innerHTML = `<p style="color:#ff4d4d;">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>`;
        return;
    }

    try {
        const response = await fetch(`/api/search?q=${encodeURIComponent(finalQuery)}`);
        const data = await response.json();

        if (data.count === 0) {
            resultsDiv.innerHTML = `<p style="color:#aaa;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            return;
        }

        resultsDiv.innerHTML = data.results
            .map(item => `
                <div class="item">
                    <h3>${item.title || "ì œëª© ì—†ìŒ"}</h3>
                    <p><strong>ëŒ€ìƒ:</strong> ${item.target}</p>
                    <p><strong>ì§€ì›ê¸ˆ/í˜œíƒ:</strong> ${item.budget}</p>
                    <p><strong>ë§ˆê°ì¼:</strong> ${item.deadline}</p>
                </div>
            `)
            .join("");
    } catch (err) {
        resultsDiv.innerHTML = `<p style="color:red;">ê²€ìƒ‰ ì‹¤íŒ¨: ${err}</p>`;
    }
}

// ê²€ìƒ‰ ì°½ ì…ë ¥ ì‹œ ë°”ë¡œ ê²€ìƒ‰
document.getElementById("query").addEventListener("input", performSearch);

// ì¹´í…Œê³ ë¦¬ ì„ íƒë§Œ í•´ë„ ê²€ìƒ‰ ìë™ ì‹¤í–‰
document.getElementById("category").addEventListener("change", performSearch);

// Enter í‚¤ë¡œ ê²€ìƒ‰ ì‹¤í–‰
document.getElementById("query").addEventListener("keypress", function (e) {
    if (e.key === "Enter") {
        performSearch();
    }
});
</script>
