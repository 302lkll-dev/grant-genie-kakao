<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì§€ì›ì§€ë‹ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: #f5f7fb;
      color: #222;
    }

    .wrap {
      max-width: 900px;
      margin: 40px auto 60px;
      padding: 0 16px;
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
    }

    .title {
      font-size: 30px;
      font-weight: 800;
      letter-spacing: 4px;
      color: #153e9f;
    }

    .subtitle {
      margin-top: 6px;
      font-size: 13px;
      color: #777;
    }

    .search-box {
      background: #fff;
      border-radius: 12px;
      padding: 18px 18px 14px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.10);
      border: 1px solid #e2e8f0;
      margin-bottom: 18px;
    }

    .search-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .search-row input[type="text"] {
      flex: 1 1 220px;
      padding: 9px 12px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-size: 14px;
      outline: none;
    }

    .search-row input[type="text"]:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.15);
    }

    .search-row select {
      flex: 0 0 130px;
      padding: 9px 8px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-size: 13px;
      background: #f8fafc;
    }

    .search-row button {
      padding: 9px 18px;
      border-radius: 8px;
      border: none;
      background: #2563eb;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      flex: 0 0 80px;
    }

    .search-row button:hover {
      background: #1d4ed8;
    }

    .tips {
      margin-top: 8px;
      font-size: 12px;
      color: #94a3b8;
    }

    .result-info {
      font-size: 13px;
      color: #6b7280;
      margin: 6px 2px 10px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 14px;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
      border: 1px solid #e2e8f0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 700;
      color: #111827;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .chip {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
    }

    .meta {
      font-size: 13px;
      color: #4b5563;
      margin-top: 4px;
      line-height: 1.5;
    }

    .meta span {
      display: block;
    }

    .deadline {
      font-weight: 600;
      color: #b91c1c;
    }

    .link {
      margin-top: 8px;
      font-size: 13px;
    }

    .link a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
    }

    .link a:hover {
      text-decoration: underline;
    }

    .empty {
      text-align: center;
      color: #9ca3af;
      font-size: 14px;
      margin-top: 40px;
    }

    @media (max-width: 600px) {
      .wrap {
        margin-top: 24px;
      }
      .search-row {
        flex-direction: column;
        align-items: stretch;
      }
      .search-row select,
      .search-row button {
        flex: 1 1 auto;
        width: 100%;
      }
      .title {
        font-size: 26px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="title">ì§€ì›ì§€ë‹ˆ ğŸ”</div>
      <div class="subtitle">í‚¤ì›Œë“œ + ì¹´í…Œê³ ë¦¬ë¡œ í•œ ë²ˆì— ì°¾ëŠ” ì •ì±… ê²€ìƒ‰ ë„ìš°ë¯¸</div>
    </header>

    <section class="search-box">
      <div class="search-row">
        <input id="queryInput" type="text" placeholder="ê²€ìƒ‰ì–´ (ì˜ˆ: ì²­ë…„, ì™¸ì‹, ê²½ê¸°)" />

        <select id="categorySelect">
          <option value="">ì „ì²´ ìœ í˜•</option>
          <option value="ì²­ë…„">ì²­ë…„</option>
          <option value="í•œë¶€ëª¨">í•œë¶€ëª¨</option>
          <option value="ì¥ì• ì¸">ì¥ì• ì¸</option>
          <option value="ì†Œìƒê³µì¸">ì†Œìƒê³µì¸</option>
        </select>

        <select id="targetSelect">
          <option value="">ì „ì²´ ëŒ€ìƒ</option>
          <option value="ê°œì¸">ê°œì¸</option>
          <option value="ê¸°ì—…">ê¸°ì—…</option>
          <option value="ë‹¨ì²´">ë‹¨ì²´</option>
        </select>

        <button id="searchBtn">ê²€ìƒ‰</button>
      </div>
      <div class="tips">
        ğŸ‘‰ ê²€ìƒ‰ì–´ê°€ ì—†ì–´ë„, <b>ì¹´í…Œê³ ë¦¬ë§Œ ì„ íƒí•´ë„ ê²€ìƒ‰</b>ë©ë‹ˆë‹¤.
      </div>
    </section>

    <div id="resultInfo" class="result-info"></div>
    <section id="resultArea" class="grid"></section>
    <div id="emptyMsg" class="empty" style="display:none;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
  </div>

  <script>
    const queryInput   = document.getElementById('queryInput');
    const categorySel  = document.getElementById('categorySelect');
    const targetSel    = document.getElementById('targetSelect');
    const searchBtn    = document.getElementById('searchBtn');
    const resultArea   = document.getElementById('resultArea');
    const resultInfo   = document.getElementById('resultInfo');
    const emptyMsg     = document.getElementById('emptyMsg');

    searchBtn.addEventListener('click', search);
    queryInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') search();
    });

    async function search() {
      const q   = queryInput.value.trim();
      const cat = categorySel.value.trim();
      const tgt = targetSel.value.trim();

      // âœ… ì™„ì „ ë¹ˆ ìƒíƒœë§Œ ë§‰ê¸° (ê²€ìƒ‰ì–´ë„ ì—†ê³ , ì¹´í…Œê³ ë¦¬/ëŒ€ìƒë„ ì—†ì„ ë•Œ)
      if (!q && !cat && !tgt) {
        alert('ê²€ìƒ‰ì–´ ë˜ëŠ” ì¹´í…Œê³ ë¦¬/ëŒ€ìƒ ì¤‘ í•˜ë‚˜ëŠ” ì„ íƒí•´ ì£¼ì„¸ìš”.');
        queryInput.focus();
        return;
      }

      resultInfo.textContent = 'ê²€ìƒ‰ ì¤‘...';
      resultArea.innerHTML   = '';
      emptyMsg.style.display = 'none';

      try {
        const params = new URLSearchParams();
        if (q)   params.set('q', q);
        if (cat) params.set('category', cat);
        if (tgt) params.set('targetType', tgt);

        const res  = await fetch('/api/search?' + params.toString());
        if (!res.ok) throw new Error('ê²€ìƒ‰ API ì˜¤ë¥˜: ' + res.status);

        const data = await res.json();
        const list = data.results || [];

        let infoText = `ì´ ${data.count || list.length || 0}ê±´ì˜ ì •ì±…ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`;
        if (cat) infoText += ` (ì¹´í…Œê³ ë¦¬: ${cat})`;
        if (tgt) infoText += ` / ëŒ€ìƒ: ${tgt}`;
        resultInfo.textContent = infoText;

        renderResults(list);
      } catch (err) {
        console.error(err);
        resultInfo.textContent = 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        emptyMsg.style.display = 'block';
        emptyMsg.textContent   = 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
      }
    }

    function renderResults(list) {
      resultArea.innerHTML = '';

      if (!list.length) {
        emptyMsg.style.display = 'block';
        emptyMsg.textContent   = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ì¡°ê±´ì„ ë°”ê¾¸ì–´ ë‹¤ì‹œ ê²€ìƒ‰í•´ ë³´ì„¸ìš”.';
        return;
      }

      emptyMsg.style.display = 'none';

      list.forEach(item => {
        const card = document.createElement('article');
        card.className = 'card';

        const title = document.createElement('div');
        title.className = 'card-title';
        title.textContent = item.title || 'ì œëª© ì—†ìŒ';
        card.appendChild(title);

        const chipRow = document.createElement('div');
        chipRow.className = 'chip-row';

        if (item.region) {
          const c = document.createElement('div');
          c.className = 'chip';
          c.textContent = item.region;
          chipRow.appendChild(c);
        }

        if (item.category) {
          const c = document.createElement('div');
          c.className = 'chip';
          c.textContent = item.category;
          chipRow.appendChild(c);
        }

        if (item.target_type) {
          const c = document.createElement('div');
          c.className = 'chip';
          c.textContent = item.target_type;
          chipRow.appendChild(c);
        }

        card.appendChild(chipRow);

        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.innerHTML = `
          <span><b>ëŒ€ìƒ</b> : ${item.target || '-'}</span>
          <span><b>ì‚°ì—…ë¶„ì•¼</b> : ${item.industry || '-'}</span>
          <span><b>ì˜ˆì‚°</b> : ${item.budget || '-'}</span>
          <span><b>ìœ í˜•</b> : ${item.benefit_type || '-'}</span>
          <span class="deadline"><b>ë§ˆê°</b> : ${item.deadline || 'ìƒì‹œ / ë¯¸ì •'}</span>
        `;
        card.appendChild(meta);

        if (item.link) {
          const link = document.createElement('div');
          link.className = 'link';
          link.innerHTML = `<a href="${item.link}" target="_blank" rel="noopener noreferrer">ìƒì„¸ë³´ê¸°</a>`;
          card.appendChild(link);
        }

        resultArea.appendChild(card);
      });
    }
  </script>
</body>
</html>
